#Installer
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install openssl libapr1 curl
test:
  override:
    - >
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esinstall.sh)
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/sginstall.sh) -d -v -c -s
            sudo sed -i -e 's/network.host: 0.0.0.0/network.host: localhost/g' /etc/elasticsearch/elasticsearch.yml
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esrestart.sh)
            sleep 30
            sudo ls -la /etc/elasticsearch
            sudo ls -la /var/log/elasticsearch
            sudo cat /etc/elasticsearch/elasticsearch.yml
            sudo cat /var/log/elasticsearch/*
            curl -k -vv -u admin:admin https://localhost:9200/_searchguard/authinfo
            curl -k -vv -u admin:admin https://localhost:9200/_searchguard/sslinfo
            curl -k -vv -u admin:admin https://localhost:9200/_cluster/health
            sudo killall java