#Installer
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install openssl libapr1 curl
test:
  override:
    - |
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esinstall.sh) 5.0.2
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/sginstall.sh) -d -v -c -s
            sudo sed -i -e 's/network.host: 0.0.0.0/network.host: localhost/g' /etc/elasticsearch/elasticsearch.yml
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esrestart.sh)
            sleep 30
            ./sgadmin_demo.sh
            #sudo ls -la /etc/elasticsearch
            sudo ls -la /var/log/elasticsearch
            #sudo cat /etc/elasticsearch/elasticsearch.yml
            curl -k -u admin:admin https://localhost:9200/_searchguard/authinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_searchguard/sslinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_cluster/health?pretty
            sudo killall java
            sudo cat /var/log/elasticsearch/*
            sudo apt-get purge -f -y elasticsearch 
  
   - |
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esinstall.sh) 5.1.2
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/sginstall.sh) -d -v -c -s
            sudo sed -i -e 's/network.host: 0.0.0.0/network.host: localhost/g' /etc/elasticsearch/elasticsearch.yml
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esrestart.sh)
            sleep 30
            ./sgadmin_demo.sh
            #sudo ls -la /etc/elasticsearch
            sudo ls -la /var/log/elasticsearch
            #sudo cat /etc/elasticsearch/elasticsearch.yml
            curl -k -u admin:admin https://localhost:9200/_searchguard/authinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_searchguard/sslinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_cluster/health?pretty
            sudo killall java
            sudo cat /var/log/elasticsearch/*  
            sudo apt-get purge -f -y elasticsearch         

   - |
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esinstall.sh) 5.2.2
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/sginstall.sh) -d -v -c -s
            sudo sed -i -e 's/network.host: 0.0.0.0/network.host: localhost/g' /etc/elasticsearch/elasticsearch.yml
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esrestart.sh)
            sleep 30
            ./sgadmin_demo.sh
            #sudo ls -la /etc/elasticsearch
            sudo ls -la /var/log/elasticsearch
            #sudo cat /etc/elasticsearch/elasticsearch.yml
            curl -k -u admin:admin https://localhost:9200/_searchguard/authinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_searchguard/sslinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_cluster/health?pretty
            sudo killall java
            sudo cat /var/log/elasticsearch/*
            sudo apt-get purge -f -y elasticsearch 
            
   - |
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esinstall.sh) 5.3.0
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/sginstall.sh) -d -v -c -s
            sudo sed -i -e 's/network.host: 0.0.0.0/network.host: localhost/g' /etc/elasticsearch/elasticsearch.yml
            bash <(curl -s https://raw.githubusercontent.com/floragunncom/installer/next/helpers/esrestart.sh)
            sleep 30
            ./sgadmin_demo.sh
            #sudo ls -la /etc/elasticsearch
            sudo ls -la /var/log/elasticsearch
            #sudo cat /etc/elasticsearch/elasticsearch.yml
            curl -k -u admin:admin https://localhost:9200/_searchguard/authinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_searchguard/sslinfo?pretty
            curl -k -u admin:admin https://localhost:9200/_cluster/health?pretty
            sudo killall java
            sudo cat /var/log/elasticsearch/*
            sudo apt-get purge -f -y elasticsearch 